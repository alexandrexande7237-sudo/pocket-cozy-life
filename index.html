<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pocket Cozy Life</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<link rel="icon" type="image/png" href="65 Sem T√≠tulo_20251225154106.png"> 
<link rel="shortcut icon" type="image/png" href="65 Sem T√≠tulo_20251225154106.png">

<style>
/* Estilos Globais e Reset */
body{
  margin:0;
  background:#f4f4f4;
  font-family:'Poppins', Arial, sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

#app{
  max-width:360px;
  width:100%;
  height:800px;
  margin:auto;
  background:#fff;
  display:flex;
  flex-direction:column;
  border-radius:20px;
  box-shadow:0 10px 30px rgba(0,0,0,0.15); 
  overflow:hidden;
}

header{
  background:#ffb3c1;
  color:#fff;
  text-align:center;
  padding:15px;
  font-size:22px;
  font-weight:700;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
}

#hud{
  display:flex;
  justify-content:space-around;
  background:#ffccd5;
  padding:10px;
  font-weight:600;
  font-size:16px;
}

#hud div{
  background:#fff;
  padding:5px 10px;
  border-radius:15px;
  box-shadow:inset 0 1px 3px rgba(0,0,0,0.1);
}

#room{
  flex:1;
  background:#fff3e0;
  position:relative;
  overflow:hidden;
}

.character{
  position:absolute;
  bottom:20px;
  font-size:60px;
  transition:left 0.5s ease-in-out;
  z-index: 2; 
}

#player{ left:60px; }
#partner{ left:180px; }
#pet{
  left:280px;
  font-size:45px;
}

.furniture-item{
  position:absolute;
  font-size:40px;
  cursor:pointer;
  z-index: 1; 
}

/* Z-index da Mob√≠lia conforme a posi√ß√£o (parede, ch√£o, teto) */
.floor-item { z-index: 1; }
.wall-item { z-index: 0; }
.ceiling-item { z-index: 3; }


#status{
  text-align:center;
  background:#f8bbd0;
  color:#444;
  padding:8px;
  font-size:16px;
  font-weight:600;
}

footer{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  padding:10px;
  background:#ffe8e8;
}

button{
  border:none;
  border-radius:15px;
  background:#ff6f91;
  color:white;
  padding:12px 8px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 3px 0 #d94b6f;
  transition:all 0.1s;
}

button:active{
  box-shadow:0 1px 0 #d94b6f;
  transform:translateY(2px);
}

/* Estilos da Modal (Invent√°rio e Loja) */
.modal {
  display: none;
  position: fixed;
  z-index: 100;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.6);
}

.modal-content {
  background-color: #fff;
  margin: 10% auto;
  padding: 25px;
  border-radius: 20px;
  width: 90%;
  max-width: 340px;
  box-shadow: 0 5px 20px rgba(0,0,0,0.5);
}

.close-button {
  color: #aaa;
  float: right;
  font-size: 32px;
  font-weight: bold;
}
.close-button:hover,
.close-button:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
.modal h3 {
    border-bottom: 2px solid #ffccd5;
    padding-bottom: 5px;
    margin-top: 20px;
    font-size: 18px;
    color: #ff6f91;
}

.item-list {
  display: grid;
  grid-template-columns: 1fr 1fr; 
  gap: 12px;
  padding: 10px 0;
  max-height: 250px;
  overflow-y: auto; 
}

.item-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
    border: 1px solid #ffccd5;
    border-radius: 10px;
    text-align: center;
    font-size: 12px;
    min-height: 120px;
}
.item-card .icon {
    font-size: 30px;
    margin-bottom: 5px;
}
.item-card button {
    margin-top: 5px;
    padding: 6px 10px;
    font-size: 11px;
    width: 90%;
}
.item-card .equipped {
    color: green;
    font-weight: bold;
}
</style>
</head>

<body onload="loadGame()"> 
<div id="app">

<header>Pocket Cozy Life</header>

<div id="hud">
  <div>üí∞ <span id="money">100</span></div>
  <div>‚ù§Ô∏è <span id="love">75</span></div>
  <button onclick="saveGame()" style="background:#ffb3c1;box-shadow:0 3px 0 #cf919d; font-size:12px;">üíæ Salvar</button>
</div>

<div id="room">
  <div id="furniture-container"></div>
  <div id="player" class="character">üòä</div>
  <div id="partner" class="character">ü•∞</div>
  <div id="pet" class="character">üê∂</div>
</div>

<div id="status">Bem-vindo(a) ao Pocket Cozy Life!</div>

<footer>
  <button onclick="changeRoom()">üè† C√¥modo</button>
  <button onclick="work()">üíº Trabalhar</button>
  <button onclick="loveUp()">üíñ Amor</button>
  <button onclick="openShop()">üõçÔ∏è Loja</button>
  <button onclick="openInventory()">üëï Invent√°rio</button>
  <button onclick="openPlaceFurniture()">üõãÔ∏è Colocar</button>
</footer>

</div>

<div id="inventoryModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeModal('inventoryModal')">&times;</span>
    <h3>üëï Suas Roupas & Acess√≥rios</h3>
    <div id="inventoryClothesList" class="item-list"></div>
    
    <h3>üõãÔ∏è Mob√≠lia no C√¥modo Atual</h3>
    <div id="inventoryFurnitureList" class="item-list"></div>
  </div>
</div>

<div id="shopModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeModal('shopModal')">&times;</span>
    <h3>üõçÔ∏è Loja de Itens</h3>
    
    <h4>Roupas & Acess√≥rios</h4>
    <div id="shopClothesList" class="item-list"></div>
    
    <h4>Mob√≠lia</h4>
    <div id="shopFurnitureList" class="item-list"></div>
  </div>
</div>

<div id="placeModal" class="modal">
  <div class="modal-content">
    <span class="close-button" onclick="closeModal('placeModal')">&times;</span>
    <h3>üõãÔ∏è Mob√≠lia para Colocar</h3>
    <p>Itens que voc√™ possui e pode colocar na sala:</p>
    <div id="placeFurnitureList" class="item-list"></div>
  </div>
</div>

<script>
// --- Vari√°veis Globais (Valores Padr√£o) ---
let money = 100;
let love = 75;
let roomIndex = 0;

// Mob√≠lia colocada em CADA c√¥modo (CHAVE DE MUDAN√áA)
let placedFurniture = {
    // Exemplo: '0': [ {key: 'sofa_red', id: 123, bottom: '...', left: '...'}, ... ],
};

// Estado da Customiza√ß√£o
let playerSkinId = 0;
let partnerSkinId = 0;
let petSkinId = 0;

// Acess√≥rios
let playerAccessoryId = 0;
let partnerAccessoryId = 0;
let petAccessoryId = 0;


// Itens possu√≠dos (IDs dos cat√°logos)
let ownedSkins = {
    player: [0], 
    partner: [0],
    pet: [0]
};
let ownedAccessories = { // NOVO
    player: [0], 
    partner: [0],
    pet: [0]
};
let ownedFurniture = []; // Chaves da mob√≠lia que pode ser colocada

// --- Cat√°logo de Itens (EXPANDIDO) ---
const SHOP_ITEMS = {
    // --- SKINS (Roupas/Corpo) ---
    skins: [
        // Padr√£o (IDs 0)
        { type: 'skin', char: 'player', id: 0, icon: "üòä", name: "Padr√£o", price: 0 },
        { type: 'skin', char: 'partner', id: 0, icon: "ü•∞", name: "Padr√£o", price: 0 },
        { type: 'skin', char: 'pet', id: 0, icon: "üê∂", name: "Padr√£o", price: 0 },
        
        // Player Skins
        { type: 'skin', char: 'player', id: 1, icon: "üòé", name: "√ìculos de Sol", price: 50 },
        { type: 'skin', char: 'player', id: 2, icon: "üòá", name: "Aur√©ola", price: 75 },
        { type: 'skin', char: 'player', id: 3, icon: "üßë‚Äçüíª", name: "Gamer", price: 120 },
        { type: 'skin', char: 'player', id: 4, icon: "üë©‚Äçüé§", name: "Rock Star", price: 180 },
        { type: 'skin', char: 'player', id: 5, icon: "ü§°", name: "Palha√ßo", price: 90 }, // NOVO
        
        // Partner Skins
        { type: 'skin', char: 'partner', id: 1, icon: "üòç", name: "Cora√ß√£o", price: 50 },
        { type: 'skin', char: 'partner', id: 2, icon: "üòò", name: "Beijinho", price: 75 },
        { type: 'skin', char: 'partner', id: 3, icon: "üë©‚Äçüç≥", name: "Cozinheira", price: 120 },
        { type: 'skin', char: 'partner', id: 4, icon: "üë®‚Äçüç≥", name: "Chef Famoso", price: 180 }, 
        { type: 'skin', char: 'partner', id: 5, icon: "üßçüèΩ‚Äç‚ôÄÔ∏è", name: "Feminino Padr√£o", price: 0 }, // NOVO (Base)
        { type: 'skin', char: 'partner', id: 6, icon: "üßçüèª", name: "Masculino Claro", price: 0 }, // NOVO (Base)
        { type: 'skin', char: 'partner', id: 7, icon: "üßçüèª‚Äç‚ôÄÔ∏è", name: "Feminino Claro", price: 0 }, // NOVO (Base)
        
        // Pet Skins (Base e Fantasias)
        { type: 'skin', char: 'pet', id: 1, icon: "üê±", name: "Gatinho", price: 40 },
        { type: 'skin', char: 'pet', id: 2, icon: "üê∞", name: "Coelhinho", price: 60 },
        { type: 'skin', char: 'pet', id: 3, icon: "üêª", name: "Ursinho", price: 100 },
        { type: 'skin', char: 'pet', id: 4, icon: "üêµ", name: "Macaquinho", price: 120 },
        { type: 'skin', char: 'pet', id: 5, icon: "üêØ", name: "Tigrinho", price: 150 },
        { type: 'skin', char: 'pet', id: 6, icon: "üê∫", name: "Lobinho", price: 150 },
        { type: 'pet', id: 7, icon: "üêπ", name: "Hamster", price: 110 }, // NOVO
        { type: 'pet', id: 8, icon: "ü¶ä", name: "Raposa", price: 130 }, // NOVO
        { type: 'pet', id: 9, icon: "üê∑", name: "Porquinho", price: 90 }, // NOVO
        { type: 'pet', id: 10, icon: "üê¥", name: "Cavalinho", price: 160 }, // NOVO
        { type: 'pet', id: 11, icon: "ü¶Ñ", name: "Unic√≥rnio", price: 200 },
        { type: 'pet', id: 12, icon: "üêâ", name: "Drag√£ozinho", price: 250 },
    ],
    // --- ACCESSORIES (Acess√≥rios de Cabe√ßa) ---
    accessories: [
        { type: 'accessory', char: 'player', id: 0, icon: "", name: "Nenhum", price: 0 }, // Padr√£o
        { type: 'accessory', char: 'partner', id: 0, icon: "", name: "Nenhum", price: 0 }, // Padr√£o
        { type: 'accessory', char: 'pet', id: 0, icon: "", name: "Nenhum", price: 0 }, // Padr√£o

        { type: 'accessory', char: 'player', id: 1, icon: "üéÄ", name: "La√ßo", price: 40 },
        { type: 'accessory', char: 'player', id: 2, icon: "üëí", name: "Chap√©u de Palha", price: 60 },
        { type: 'accessory', char: 'player', id: 3, icon: "üéì", name: "Capelo", price: 80 },
        { type: 'accessory', char: 'partner', id: 1, icon: "üé©", name: "Cartola", price: 70 },
        { type: 'pet', id: 1, icon: "üëë", name: "Coroa (Pet)", price: 100 },
        { type: 'pet', id: 2, icon: "üß¢", name: "Bon√©", price: 50 },
    ],
    // --- FURNITURE (Mob√≠lia) ---
    furniture: [
        // Ch√£o/Parede (posi√ß√£o) √© definido pelo c√≥digo de coloca√ß√£o
        // Posi√ß√£o: 0 = Ch√£o (Baixo), 1 = Parede (Meio), 2 = Teto (Alto)
        { icon: "üõãÔ∏è", key: "sofa_red", name: "Sof√° Vermelho", price: 50, position: 0 },
        { icon: "ü™ë", key: "chair_wood", name: "Cadeira de Madeira", price: 30, position: 0 },
        { icon: "üñºÔ∏è", key: "painting", name: "Quadro", price: 80, position: 1 },
        { icon: "ü™¥", key: "plant_pot", name: "Vaso de Planta", price: 40, position: 0 },
        { icon: "üì∫", key: "tv_flat", name: "Televis√£o", price: 150, position: 1 },
        { icon: "üõèÔ∏è", key: "bed_fancy", name: "Cama de Casal Luxo", price: 300, position: 0 },
        { icon: "üíª", key: "gaming_pc", name: "Setup Gamer", price: 220, position: 0 },
        { icon: "üéπ", key: "piano", name: "Piano de Cauda", price: 400, position: 0 },
        { icon: "üçΩÔ∏è", key: "dinner_set", name: "Jogo de Jantar", price: 120, position: 0 },
        { icon: "üéà", key: "balloons", name: "Bal√µes de Festa", price: 60, position: 1 }, // NOVO (Parede)
        
        // Novos itens de Mob√≠lia
        { icon: "‚õ©Ô∏è", key: "shrine", name: "Santu√°rio", price: 250, position: 0 }, // NOVO (Ch√£o)
        { icon: "‚õ≤", key: "fountain", name: "Fonte", price: 350, position: 0 }, // NOVO (Ch√£o)
        { icon: "üí°", key: "light_bulb", name: "L√¢mpada", price: 80, position: 2 }, // NOVO (Teto)
        { icon: "ü™©", key: "disco_ball", name: "Bola de Disco", price: 150, position: 2 }, // NOVO (Teto)
        { icon: "‚õ≥", key: "golf_hole", name: "Buraco de Golf", price: 70, position: 0 }, // NOVO (Ch√£o)
        { icon: "‚õ∫", key: "tent", name: "Barraca", price: 180, position: 0 }, // NOVO (Ch√£o)
        { icon: "‚õ±Ô∏è", key: "umbrella", name: "Guarda-sol", price: 100, position: 0 }, // NOVO (Ch√£o)
        { icon: "ü™ü", key: "window", name: "Janela", price: 160, position: 1 }, // NOVO (Parede)
    ]
};

// --- Elementos DOM ---
const room=document.getElementById("room");
const status=document.getElementById("status");
const moneySpan=document.getElementById("money");
const loveSpan=document.getElementById("love");
const furnitureContainer = document.getElementById("furniture-container");
const playerChar = document.getElementById("player");
const partnerChar = document.getElementById("partner");
const petChar = document.getElementById("pet");

// --- Fun√ß√µes de Estado e Salvar/Carregar ---

function getSkinIcon(char, id) {
    return SHOP_ITEMS.skins.find(s => s.char === char && s.id === id)?.icon || '';
}

function getAccessoryIcon(char, id) {
    return SHOP_ITEMS.accessories.find(a => a.char === char && a.id === id)?.icon || '';
}

function updateDisplay() {
    moneySpan.innerText = money;
    loveSpan.innerText = love;
    
    // Atualiza o estado da sala (cor e nome)
    room.style.background = rooms[roomIndex].color;
    status.innerText = `Voc√™ est√° na ${rooms[roomIndex].name}`;

    // Atualiza a apar√™ncia dos personagens (Skin + Acess√≥rio)
    const playerSkin = getSkinIcon('player', playerSkinId);
    const partnerSkin = getSkinIcon('partner', partnerSkinId);
    const petSkin = getSkinIcon('pet', petSkinId);
    
    const playerAccessory = getAccessoryIcon('player', playerAccessoryId);
    const partnerAccessory = getAccessoryIcon('partner', partnerAccessoryId);
    const petAccessory = getAccessoryIcon('pet', petAccessoryId);
    
    // Concatena a skin e o acess√≥rio para exibir (pode exigir ajustes manuais de emoji)
    playerChar.innerText = playerAccessory + playerSkin;
    partnerChar.innerText = partnerAccessory + partnerSkin;
    petChar.innerText = petAccessory + petSkin;
    
    // Desenha a mob√≠lia do c√¥modo atual
    renderRoomFurniture();
}

function saveGame() {
    const gameState = {
        money,
        love,
        roomIndex,
        playerSkinId,
        partnerSkinId,
        petSkinId,
        playerAccessoryId, // NOVO
        partnerAccessoryId, // NOVO
        petAccessoryId, // NOVO
        ownedSkins,
        ownedAccessories, // NOVO
        ownedFurniture,
        // Mob√≠lia na sala (agora √© o objeto completo de todos os c√¥modos)
        placedFurniture 
    };
    
    try {
        localStorage.setItem('pocketCozyLifeSave', JSON.stringify(gameState));
        status.innerText = "‚úÖ Jogo Salvo com Sucesso!";
    } catch (e) {
        status.innerText = "‚ùå Erro ao salvar o jogo.";
        console.error("Save error:", e);
    }
}

function loadGame() {
    try {
        const savedData = localStorage.getItem('pocketCozyLifeSave');
        if (savedData) {
            const gameState = JSON.parse(savedData);
            
            // Carrega vari√°veis principais
            money = gameState.money;
            love = gameState.love;
            roomIndex = gameState.roomIndex;

            // Carrega customiza√ß√£o
            playerSkinId = gameState.playerSkinId;
            partnerSkinId = gameState.partnerSkinId;
            petSkinId = gameState.petSkinId;
            
            // Carrega Acess√≥rios (Adicionado Fallback para evitar erros em saves antigos)
            playerAccessoryId = gameState.playerAccessoryId || 0;
            partnerAccessoryId = gameState.partnerAccessoryId || 0;
            petAccessoryId = gameState.petAccessoryId || 0;
            
            ownedSkins = gameState.ownedSkins;
            ownedAccessories = gameState.ownedAccessories || { player: [0], partner: [0], pet: [0] }; // Fallback
            ownedFurniture = gameState.ownedFurniture;

            // Carrega a mob√≠lia de TODOS os c√¥modos (CHAVE DE MUDAN√áA)
            placedFurniture = gameState.placedFurniture || {};
            
            // Inicializa a mob√≠lia do c√¥modo atual
            updateDisplay();
            status.innerText = "‚úÖ Jogo Carregado!";
        } else {
            updateDisplay();
        }
    } catch (e) {
        status.innerText = "‚ùå Erro ao carregar o jogo. Iniciando novo jogo.";
        console.error("Load error:", e);
        // Limpa qualquer dado quebrado se o carregamento falhar
        localStorage.removeItem('pocketCozyLifeSave');
        updateDisplay();
    }
}


// --- Fun√ß√µes Principais do Jogo ---

const rooms=[
  {name:"Cozinha", color:"#fff3e0"},
  {name:"Sala", color:"#e3f2fd"},
  {name:"Quarto", color:"#fce4ec"},
  {name:"Jardim", color:"#e8f5e9"}
];

function changeRoom(){
  roomIndex=(roomIndex+1)%rooms.length;
  updateDisplay();
  saveGame();
}

function updateMoney(amount){
    money += amount;
    updateDisplay();
    saveGame();
}

function work(){
  updateMoney(20);
  status.innerText="Voc√™ trabalhou üíº (+20$)";
}

function loveUp(){
  love+=5;
  updateDisplay();
  saveGame(); 
  status.innerText="Momento fofo üíñ (+5 Love)";
}

// NOVO: Desenha a mob√≠lia do c√¥modo atual
function renderRoomFurniture() {
    furnitureContainer.innerHTML = '';
    const currentRoomKey = String(roomIndex);
    
    // Garante que a lista exista
    placedFurniture[currentRoomKey] = placedFurniture[currentRoomKey] || [];
    
    // Desenha cada item na sala
    placedFurniture[currentRoomKey].forEach(itemData => {
        const itemCatalog = SHOP_ITEMS.furniture.find(f => f.key === itemData.key);
        if (!itemCatalog) return;

        const itemElement = document.createElement("div");
        itemElement.innerText = itemCatalog.icon;
        itemElement.classList.add("furniture-item");

        // Define a classe de Z-index baseado na posi√ß√£o
        if (itemCatalog.position === 0) itemElement.classList.add("floor-item");
        else if (itemCatalog.position === 1) itemElement.classList.add("wall-item");
        else if (itemCatalog.position === 2) {
            itemElement.classList.add("ceiling-item");
            // Se for luz/teto, inverte para dar a sensa√ß√£o de pendurado
            if(itemCatalog.key === 'light_bulb') itemElement.style.transform = "rotate(180deg)";
        }
        
        itemElement.style.bottom = itemData.bottom;
        itemElement.style.left = itemData.left; 

        // Adiciona um listener para permitir remover pelo clique na sala (opcional)
        itemElement.onclick = () => removeItem(itemData.id, currentRoomKey);

        furnitureContainer.appendChild(itemElement);
    });
}

// Coloca um item de mob√≠lia na sala (a partir da Place Modal)
function addItemToRoom(key){
    const itemCatalog = SHOP_ITEMS.furniture.find(f => f.key === key);
    if (!itemCatalog) return;
    
    const currentRoomKey = String(roomIndex);

    // Posi√ß√£o ajustada conforme a categoria:
    let bottom, left;

    if (itemCatalog.position === 0) { // Ch√£o
        bottom = Math.floor(Math.random() * 50) + 10 + "px"; 
        left = Math.floor(Math.random() * 260) + 20 + "px"; 
    } else if (itemCatalog.position === 1) { // Parede/Meio
        bottom = Math.floor(Math.random() * 150) + 100 + "px"; 
        left = Math.floor(Math.random() * 260) + 20 + "px"; 
    } else { // Teto/Cima
        bottom = Math.floor(Math.random() * 50) + 300 + "px"; 
        left = Math.floor(Math.random() * 260) + 20 + "px"; 
    }
    
    const newItemData = {
        id: Date.now() + Math.random(), // ID √∫nico para remo√ß√£o
        key: key,
        bottom: bottom,
        left: left
    };

    // Adiciona o item √† lista do c√¥modo atual
    placedFurniture[currentRoomKey] = placedFurniture[currentRoomKey] || [];
    placedFurniture[currentRoomKey].push(newItemData);

    renderRoomFurniture();
    closeModal('placeModal');
    status.innerText = `Mob√≠lia colocada em ${rooms[roomIndex].name}: ${itemCatalog.name} ${itemCatalog.icon}`;
    saveGame();
}


// --- Fun√ß√µes da Modal ---

function openModal(modalId) {
    document.getElementById(modalId).style.display = "block";
}

function closeModal(modalId) {
    document.getElementById(modalId).style.display = "none";
}

// --- Fun√ß√µes da Loja ---

function openShop() {
    updateShopList();
    openModal('shopModal');
}

function updateShopList() {
    const shopClothesList = document.getElementById("shopClothesList");
    const shopFurnitureList = document.getElementById("shopFurnitureList");
    
    shopClothesList.innerHTML = '';
    shopFurnitureList.innerHTML = '';
    
    // --- SKINS & ACCESSORIES ---
    const allCustomItems = [...SHOP_ITEMS.skins, ...SHOP_ITEMS.accessories];

    allCustomItems.filter(item => item.id !== 0 || item.type === 'accessory').forEach(item => { // Filtra IDs 0, exceto acess√≥rios que usam ID 0 para "nenhum"
        let isOwned = false;
        if(item.type === 'skin') {
            isOwned = ownedSkins[item.char].includes(item.id);
        } else if (item.type === 'accessory') {
            isOwned = ownedAccessories[item.char].includes(item.id);
        }
        
        const card = document.createElement("div");
        card.classList.add("item-card");

        card.innerHTML = `<span class="icon">${item.icon}</span>`;
        card.innerHTML += `<p>${item.name} (${item.char === 'player' ? 'Voc√™' : item.char === 'partner' ? 'Parceiro' : 'Pet'})</p>`;
        
        if (isOwned && item.price > 0) { // Se for item gratuito (base skin), mostre o bot√£o de compra para facilitar encontrar
            card.innerHTML += `<button style="background:#4CAF50; box-shadow:0 3px 0 #388E3C;">‚úîÔ∏è Possu√≠do</button>`;
        } else {
            // Nova chamada para buyItem que inclui o tipo (skin ou accessory)
            card.innerHTML += `<button onclick="buyItem('${item.type}', '${item.char}', ${item.id}, ${item.price})">üí∞ ${item.price}</button>`;
        }
        shopClothesList.appendChild(card);
    });
    
    // --- MOB√çLIA ---
    SHOP_ITEMS.furniture.forEach(item => {
        const card = document.createElement("div");
        card.classList.add("item-card");

        card.innerHTML = `<span class="icon">${item.icon}</span>`;
        card.innerHTML += `<p>${item.name}</p>`;
        card.innerHTML += `<button onclick="buyItem('furniture', '${item.key}', null, ${item.price})">üí∞ ${item.price}</button>`;
        
        shopFurnitureList.appendChild(card);
    });
}

function buyItem(type, keyOrChar, id, price) {
    if (money < price) {
        status.innerText = "‚ùå Dinheiro insuficiente!";
        return;
    }

    updateMoney(-price); // J√° chama saveGame()
    
    if (type === 'skin') {
        const skinItem = SHOP_ITEMS.skins.find(s => s.char === keyOrChar && s.id === id);
        if (skinItem && !ownedSkins[keyOrChar].includes(id)) {
            ownedSkins[keyOrChar].push(id);
            status.innerText = `‚úÖ Voc√™ comprou: ${skinItem.name} ${skinItem.icon}!`;
            updateShopList();
        }
    } else if (type === 'accessory') {
        const accItem = SHOP_ITEMS.accessories.find(a => a.char === keyOrChar && a.id === id);
        if (accItem && !ownedAccessories[keyOrChar].includes(id)) {
            ownedAccessories[keyOrChar].push(id);
            status.innerText = `‚úÖ Voc√™ comprou o acess√≥rio: ${accItem.name} ${accItem.icon}!`;
            updateShopList();
        }
    } else if (type === 'furniture') {
        const furnitureItem = SHOP_ITEMS.furniture.find(f => f.key === keyOrChar);
        if (furnitureItem) {
            ownedFurniture.push(keyOrChar);
            status.innerText = `‚úÖ Voc√™ comprou: ${furnitureItem.name} ${furnitureItem.icon}! Agora coloque-a na sala.`;
        }
    }
    
    closeModal('shopModal');
    saveGame();
}

// --- Fun√ß√µes de Invent√°rio (Customiza√ß√£o) ---

function openInventory() {
    updateInventoryClothesList();
    updateInventoryFurnitureList();
    openModal('inventoryModal');
}

function updateInventoryClothesList() {
    const invClothesList = document.getElementById("inventoryClothesList");
    invClothesList.innerHTML = '';
    
    // Lista de Roupas & Acess√≥rios Comprados
    ['player', 'partner', 'pet'].forEach(char => {
        // Skins
        ownedSkins[char].forEach(skinId => {
            const skinItem = SHOP_ITEMS.skins.find(s => s.char === char && s.id === skinId);
            if (!skinItem) return;

            const isEquipped = (char === 'player' && playerSkinId === skinId) ||
                               (char === 'partner' && partnerSkinId === skinId) ||
                               (char === 'pet' && petSkinId === skinId);

            const card = document.createElement("div");
            card.classList.add("item-card");
            card.innerHTML = `<span class="icon">${skinItem.icon}</span>`;
            card.innerHTML += `<p>Skin: ${skinItem.name}</p>`;
            
            if (isEquipped) {
                card.innerHTML += `<span class="equipped">‚úÖ Vestindo</span>`;
            } else {
                card.innerHTML += `<span><button onclick="changeSkin('${char}', ${skinId})">Vestir Skin</button></span>`;
            }
            invClothesList.appendChild(card);
        });

        // Acess√≥rios
        ownedAccessories[char].forEach(accId => {
            const accItem = SHOP_ITEMS.accessories.find(a => a.char === char && a.id === accId);
            if (!accItem) return;

            const isEquipped = (char === 'player' && playerAccessoryId === accId) ||
                               (char === 'partner' && partnerAccessoryId === accId) ||
                               (char === 'pet' && petAccessoryId === accId);

            const card = document.createElement("div");
            card.classList.add("item-card");
            card.innerHTML = `<span class="icon">${accItem.icon || '‚ûñ'}</span>`; // '‚ûñ' se for o acess√≥rio "Nenhum"
            card.innerHTML += `<p>Acess√≥rio: ${accItem.name}</p>`;
            
            if (isEquipped) {
                card.innerHTML += `<span class="equipped">‚úÖ Usando</span>`;
            } else {
                card.innerHTML += `<span><button onclick="changeAccessory('${char}', ${accId})">Usar Acess√≥rio</button></span>`;
            }
            invClothesList.appendChild(card);
        });
    });
}

function updateInventoryFurnitureList() {
    const invFurnitureList = document.getElementById("inventoryFurnitureList");
    invFurnitureList.innerHTML = '';
    const currentRoomKey = String(roomIndex);
    
    // Mob√≠lia Colocada na Sala
    if(placedFurniture[currentRoomKey] && placedFurniture[currentRoomKey].length > 0){
        placedFurniture[currentRoomKey].forEach(itemData => {
            const itemCatalog = SHOP_ITEMS.furniture.find(f => f.key === itemData.key);
            if (!itemCatalog) return;

            const card = document.createElement("div");
            card.classList.add("item-card");
            card.innerHTML = `<span class="icon">${itemCatalog.icon}</span>`;
            card.innerHTML += `<p>${itemCatalog.name}</p>`;
            // Chamada de removeItem precisa do ID do item na sala e do c√¥modo
            card.innerHTML += `<span><button onclick="removeItem(${itemData.id}, '${currentRoomKey}')">Remover</button></span>`;
            invFurnitureList.appendChild(card);
        });
    } else {
         invFurnitureList.innerHTML = '<p style="grid-column: 1 / span 2; text-align: center;">Nenhuma mob√≠lia neste c√¥modo.</p>';
    }
}

// Troca a skin do personagem e salva
function changeSkin(char, id) {
    const skinItem = SHOP_ITEMS.skins.find(s => s.char === char && s.id === id);
    if (!skinItem) return;

    if (char === 'player') {
        playerSkinId = id;
    } else if (char === 'partner') {
        partnerSkinId = id;
    } else if (char === 'pet') {
        petSkinId = id;
    }
    
    status.innerText = `Skin de ${char} alterada para ${skinItem.name} ${skinItem.icon}!`;
    updateDisplay();
    updateInventoryClothesList(); 
    saveGame();
}

// NOVO: Troca o acess√≥rio do personagem e salva
function changeAccessory(char, id) {
    const accItem = SHOP_ITEMS.accessories.find(a => a.char === char && a.id === id);
    if (!accItem) return;

    if (char === 'player') {
        playerAccessoryId = id;
    } else if (char === 'partner') {
        partnerAccessoryId = id;
    } else if (char === 'pet') {
        petAccessoryId = id;
    }
    
    status.innerText = `Acess√≥rio de ${char} alterado para ${accItem.name} ${accItem.icon}!`;
    updateDisplay();
    updateInventoryClothesList(); 
    saveGame();
}

// NOVO: Remove um item de mob√≠lia da sala (precisa do ID e do c√¥modo)
function removeItem(itemId, roomKey = String(roomIndex)) {
    // Garante que estamos olhando a lista do c√¥modo correto
    const roomFurniture = placedFurniture[roomKey];
    if(!roomFurniture) return;

    const itemIndex = roomFurniture.findIndex(item => item.id === itemId);
    
    if(itemIndex > -1) {
        // Remove do array de dados
        roomFurniture.splice(itemIndex, 1); 
        
        status.innerText = "Mob√≠lia removida do c√¥modo!";
        renderRoomFurniture(); // Redesenha a sala
        updateInventoryFurnitureList(); // Atualiza a modal
        saveGame();
    }
}


// --- Fun√ß√µes de Colocar Mob√≠lia ---

function openPlaceFurniture() {
    updatePlaceFurnitureList();
    openModal('placeModal');
}

function updatePlaceFurnitureList() {
    const placeFurnitureList = document.getElementById("placeFurnitureList");
    placeFurnitureList.innerHTML = '';
    
    // Rastreia itens √∫nicos que o usu√°rio possui
    const uniqueOwnedFurniture = [...new Set(ownedFurniture)]; 
    
    if (uniqueOwnedFurniture.length > 0) {
        uniqueOwnedFurniture.forEach(key => {
            const item = SHOP_ITEMS.furniture.find(f => f.key === key);
            if (!item) return;
            
            // Conta quantas c√≥pias deste item o usu√°rio possui (opcional para exibi√ß√£o)
            const count = ownedFurniture.filter(k => k === key).length; 

            const card = document.createElement("div");
            card.classList.add("item-card");
            card.innerHTML = `<span class="icon">${item.icon}</span>`;
            card.innerHTML += `<p>${item.name}</p>`; 
            card.innerHTML += `<span><button onclick="addItemToRoom('${key}')">Colocar</button></span>`;
            
            placeFurnitureList.appendChild(card);
        });
    } else {
         placeFurnitureList.innerHTML = '<p style="grid-column: 1 / span 2; text-align: center;">Compre mob√≠lia na loja primeiro!</p>';
    }
} 

// --- Inicializa√ß√£o ---
// Fun√ß√£o de fechar modal ao clicar fora
window.onclick = function(event) {
    const inventoryModal = document.getElementById('inventoryModal');
    const shopModal = document.getElementById('shopModal');
    const placeModal = document.getElementById('placeModal');

    if (event.target == inventoryModal) {
        closeModal('inventoryModal');
    }
    if (event.target == shopModal) {
        closeModal('shopModal');
    }
    if (event.target == placeModal) {
        closeModal('placeModal');
    }
}
</script>

</body>
</html>
